<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <title>Work Day Calculator</title>
  </head>
  <body>
    <div class="container text-center">
      <h1>Work Day Calculator</h1>
      <div id="loadingSpinner">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      <div id="calculator" hidden>
        <div id="hoursWorkedContainer">
          <h2>Hours to work</h2>
          <div class="input-group mb-3 d-flex justify-content-center">
            <div class="dropdown" style="width: 100px">
              <button
                class="btn btn-secondary dropdown-toggle"
                style="width: 100px"
                type="button"
                id="dropdownMenuButton1"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                {{workingHours}}
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li v-for="hour in timeRanges.hoursWorking" :value="hour">
                  <a class="dropdown-item" href="#" @click="workingHours = hour"
                    >{{ hour }}</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div id="startingTimeContainer">
          <h2>Starting Time</h2>
          <div class="input-group mb-3">
            <input
              type="number"
              class="form-control"
              v-model="startTime.hours"
            />

            <span class="input-group-text">:</span>
            <input
              type="number"
              class="form-control"
              v-model="startTime.minutes"
            />
            <div class="dropdown">
              <button
                class="btn btn-secondary dropdown-toggle"
                type="button"
                id="dropdownMenuButton1"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              ></button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li v-for="minute in timeRanges.minutes" :value="minute">
                  <a
                    class="dropdown-item"
                    href="#"
                    @click="startTime.minutes = minute"
                    >{{ minute }}</a
                  >
                </li>
              </ul>
            </div>
            <div class="dropdown">
              <button
                class="btn btn-secondary dropdown-toggle"
                type="button"
                id="dropdownMenuButton2"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                {{startTime.ampm}}
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                <li v-for="ampm in timeRanges.ampm">
                  <a
                    class="dropdown-item"
                    href="#"
                    @click="startTime.ampm = ampm"
                  >
                    {{ampm}}</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div id="LunchContainer">
          <h2>Lunch Duration</h2>
          <div class="input-group mb-3">
            <input
              type="number"
              class="form-control"
              v-model="lunchTime.hours"
            />
            <span class="input-group-text">:</span>
            <input
              type="number"
              class="form-control"
              v-model="lunchTime.minutes"
            />
            <div class="dropdown">
              <button
                class="btn btn-secondary dropdown-toggle"
                type="button"
                id="dropdownMenuButton1"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li v-for="minute in timeRanges.minutes" :value="minute">
                  <a
                    class="dropdown-item"
                    href="#"
                    @click="lunchTime.minutes = minute"
                    >{{ minute }}</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
        <button class="btn btn-primary" @click="calculate()">Calculate</button>
        <h2 v-if="doneAt">You are done at: {{doneAt}}</h2>
      </div>

      <!-- Option 1: Bootstrap Bundle with Popper -->
      <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"
      ></script>
      <script type="module">
        import { createApp } from "https://unpkg.com/petite-vue?module";
        const am = "am";
        const pm = "pm";

        function range(start, end) {
          var ans = [];
          for (let i = start; i <= end; i++) {
            ans.push(i);
          }
          return ans;
        }

        function calculateFinishTime(startTime, lunchTime, workingHours) {
          function formatAMPM(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? "pm" : "am";
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? "0" + minutes : minutes;
            var strTime = hours + ":" + minutes + " " + ampm;
            return strTime;
          }

          const month = 2;
          const year = 2000;
          const day = 14;
          const hoursToMS = (hours) => hours * 60 * 60 * 1000;
          const minutesToMS = (minutes) => minutes * 60 * 1000;
          const start = new Date(
            year,
            month,
            day,
            startTime.ampm == am ? startTime.hours : startTime.hours + 12,
            startTime.minutes
          );
          const endTime =
            start.getTime() +
            hoursToMS(workingHours) +
            hoursToMS(lunchTime.hours) +
            minutesToMS(lunchTime.minutes);

          const end = new Date(endTime);
          return formatAMPM(end);
        }

        createApp({
          timeRanges: {
            hoursWorking: range(0, 10).reverse(),
            hours: range(1, 12).reverse(),
            minutes: [15, 30, 45],
            ampm: [am, pm],
          },
          _workingHours: 8,
          get workingHours() {
            return this._workingHours;
          },
          set workingHours(val) {
            if (!isNaN(val)) {
              this._workingHours = val;
            }
          },
          startTime: {
            hours: 9,
            minutes: 0,
            ampm: am,
          },
          lunchTime: {
            hours: 1,
            minutes: 0,
          },
          calculate() {
            this.doneAt = calculateFinishTime(
              this.startTime,
              this.lunchTime,
              this._workingHours
            );
          },
          doneAt: undefined,
        }).mount();

        document.getElementById("calculator").hidden = false;
        document.getElementById("loadingSpinner").hidden = true;
      </script>
    </div>
  </body>
</html>
